<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Solar System Debug Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        h1 { color: #0ff; margin-bottom: 20px; text-align: center; }
        .section {
            background: #111;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .section h2 { color: #ff0; margin-bottom: 10px; font-size: 18px; }
        .status { margin: 5px 0; padding-left: 20px; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .warn { color: #ff0; }
        .info { color: #0ff; }
        button {
            background: #0066cc;
            color: #fff;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover { background: #0055aa; }
        .button-group { text-align: center; margin: 20px 0; }
        #live-monitor {
            background: #000;
            border: 2px solid #0f0;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .timestamp { color: #666; }
    </style>
</head>
<body>
    <h1>üîç SOLAR SYSTEM DEBUG PANEL</h1>
    
    <div class="button-group">
        <button onclick="location.href='index.html'">üöÄ Open Main App</button>
        <button onclick="runFullDiagnostic()">üîç Run Full Diagnostic</button>
        <button onclick="testAnimation()">üé¨ Test Animation</button>
        <button onclick="testClickDetection()">üñ±Ô∏è  Test Click Detection</button>
        <button onclick="clearMonitor()">üßπ Clear Monitor</button>
    </div>

    <div class="section">
        <h2>üìä System Status</h2>
        <div id="system-status"></div>
    </div>

    <div class="section">
        <h2>ü™ê Planets</h2>
        <div id="planets-status"></div>
    </div>

    <div class="section">
        <h2>üé¨ Animation Status</h2>
        <div id="animation-status"></div>
    </div>

    <div class="section">
        <h2>üì° Live Monitor</h2>
        <div id="live-monitor"></div>
    </div>

    <script>
        let monitorLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `<div class="${type}"><span class="timestamp">[${timestamp}]</span> ${message}</div>`;
            monitorLog.push(entry);
            if (monitorLog.length > 100) monitorLog.shift();
            document.getElementById('live-monitor').innerHTML = monitorLog.join('');
            document.getElementById('live-monitor').scrollTop = document.getElementById('live-monitor').scrollHeight;
        }
        
        function clearMonitor() {
            monitorLog = [];
            document.getElementById('live-monitor').innerHTML = '';
        }
        
        function updateStatus() {
            const systemStatus = document.getElementById('system-status');
            const planetsStatus = document.getElementById('planets-status');
            const animationStatus = document.getElementById('animation-status');
            
            // Check if app is loaded
            if (typeof THREE === 'undefined') {
                systemStatus.innerHTML = '<div class="fail">‚ùå Three.js not loaded - Open main app first!</div>';
                planetsStatus.innerHTML = '<div class="fail">‚ùå No data available</div>';
                animationStatus.innerHTML = '<div class="fail">‚ùå No data available</div>';
                return;
            }
            
            // Try to access the app through the iframe or window opener
            let app = null;
            
            // Check if there's a reference to the main window
            if (window.opener && window.opener.app) {
                app = window.opener.app;
                log('‚úÖ Connected to main window via window.opener', 'pass');
            } else if (parent !== window && parent.app) {
                app = parent.app;
                log('‚úÖ Connected to parent window via parent', 'pass');
            } else {
                systemStatus.innerHTML = `
                    <div class="warn">‚ö†Ô∏è Main app not accessible from this window</div>
                    <div class="info">‚ÑπÔ∏è Open this page, then open index.html in a new tab</div>
                    <div class="info">‚ÑπÔ∏è Or open developer console (F12) on index.html and run comprehensive-diagnostic.js</div>
                `;
                planetsStatus.innerHTML = '<div class="fail">‚ùå No access to app</div>';
                animationStatus.innerHTML = '<div class="fail">‚ùå No access to app</div>';
                return;
            }
            
            // System Status
            let sysHtml = '';
            sysHtml += app ? '<div class="pass">‚úÖ App object found</div>' : '<div class="fail">‚ùå App object missing</div>';
            sysHtml += app?.sceneManager ? '<div class="pass">‚úÖ SceneManager initialized</div>' : '<div class="fail">‚ùå SceneManager missing</div>';
            sysHtml += app?.solarSystemModule ? '<div class="pass">‚úÖ SolarSystemModule initialized</div>' : '<div class="fail">‚ùå SolarSystemModule missing</div>';
            sysHtml += app?.timeSpeed ? `<div class="info">‚è±Ô∏è Time Speed: ${app.timeSpeed}x</div>` : '<div class="warn">‚ö†Ô∏è Time speed not set</div>';
            systemStatus.innerHTML = sysHtml;
            
            // Planets Status
            if (app?.solarSystemModule) {
                const ssm = app.solarSystemModule;
                const planetCount = Object.keys(ssm.planets).length;
                const objectCount = ssm.objects.length;
                
                let planetsHtml = '';
                planetsHtml += `<div class="${planetCount > 0 ? 'pass' : 'fail'}">${planetCount > 0 ? '‚úÖ' : '‚ùå'} ${planetCount} planets loaded</div>`;
                planetsHtml += `<div class="${objectCount > 0 ? 'pass' : 'fail'}">${objectCount > 0 ? '‚úÖ' : '‚ùå'} ${objectCount} selectable objects</div>`;
                
                if (planetCount > 0) {
                    planetsHtml += '<div class="info" style="margin-top: 10px;">Planet List:</div>';
                    Object.entries(ssm.planets).forEach(([name, planet]) => {
                        if (planet && planet.userData) {
                            const pos = `(${planet.position.x.toFixed(1)}, ${planet.position.y.toFixed(1)}, ${planet.position.z.toFixed(1)})`;
                            planetsHtml += `<div class="status">ü™ê ${name}: ${pos}, speed=${planet.userData.speed}</div>`;
                        }
                    });
                }
                
                planetsStatus.innerHTML = planetsHtml;
            } else {
                planetsStatus.innerHTML = '<div class="fail">‚ùå No solar system module</div>';
            }
            
            // Animation Status
            if (app?.sceneManager) {
                let animHtml = '';
                animHtml += app.sceneManager.renderer ? '<div class="pass">‚úÖ Renderer active</div>' : '<div class="fail">‚ùå No renderer</div>';
                animHtml += app.sceneManager.scene ? `<div class="info">üì¶ Scene objects: ${app.sceneManager.scene.children.length}</div>` : '<div class="fail">‚ùå No scene</div>';
                animHtml += app.sceneManager.camera ? '<div class="pass">‚úÖ Camera initialized</div>' : '<div class="fail">‚ùå No camera</div>';
                animationStatus.innerHTML = animHtml;
            } else {
                animationStatus.innerHTML = '<div class="fail">‚ùå No scene manager</div>';
            }
        }
        
        function runFullDiagnostic() {
            log('üîç Starting full diagnostic...', 'info');
            
            // Check Three.js
            if (typeof THREE === 'undefined') {
                log('‚ùå Three.js not loaded - open main app first!', 'fail');
                return;
            }
            
            log('‚úÖ Three.js loaded', 'pass');
            
            // Check for app in various contexts
            let app = null;
            if (window.opener && window.opener.app) {
                app = window.opener.app;
                log('‚úÖ Found app via window.opener', 'pass');
            } else if (parent !== window && parent.app) {
                app = parent.app;
                log('‚úÖ Found app via parent', 'pass');
            } else {
                log('‚ùå Cannot access app - not opened from main window', 'fail');
                log('‚ÑπÔ∏è Instructions:', 'info');
                log('   1. Open index.html in a new tab', 'info');
                log('   2. Press F12 to open developer console', 'info');
                log('   3. Load comprehensive-diagnostic.js in console', 'info');
                return;
            }
            
            // Run comprehensive tests
            if (app.solarSystemModule) {
                log(`‚úÖ ${Object.keys(app.solarSystemModule.planets).length} planets loaded`, 'pass');
                log(`‚úÖ ${app.solarSystemModule.objects.length} selectable objects`, 'pass');
            }
            
            updateStatus();
        }
        
        function testAnimation() {
            log('üé¨ Testing animation...', 'info');
            // Implementation depends on app access
            log('‚ö†Ô∏è Open F12 console on main app and run comprehensive-diagnostic.js', 'warn');
        }
        
        function testClickDetection() {
            log('üñ±Ô∏è  Testing click detection...', 'info');
            // Implementation depends on app access
            log('‚ö†Ô∏è Open F12 console on main app and run comprehensive-diagnostic.js', 'warn');
        }
        
        // Initial status check
        log('üöÄ Debug panel loaded', 'pass');
        log('‚ÑπÔ∏è Open index.html first, then use this panel', 'info');
        updateStatus();
        
        // Auto-refresh status every 2 seconds
        setInterval(updateStatus, 2000);
    </script>
</body>
</html>
